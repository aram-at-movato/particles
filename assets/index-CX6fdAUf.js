(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();class M{constructor(t){this.video=t,this.width=0,this.height=0,this.isReady=!1}async init(){if(console.log("Webcam.init() called"),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return console.error("navigator.mediaDevices.getUserMedia is not supported"),alert("Your browser does not support camera access or is not in a secure context."),!1;try{console.log("Requesting user media...");const t=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},frameRate:{ideal:60}},audio:!1});return console.log("Stream acquired",t),this.video.srcObject=t,new Promise(e=>{this.video.onloadedmetadata=()=>{console.log("Video metadata loaded"),this.width=this.video.videoWidth,this.height=this.video.videoHeight,this.video.play(),this.isReady=!0,e(!0)}})}catch(t){return console.error("Error accessing webcam details:",t),alert("Error accessing webcam: "+t.message),!1}}}class b{constructor(t,e){this.width=t,this.height=e,this.scale=.1,this.w=Math.floor(this.width*this.scale),this.h=Math.floor(this.height*this.scale),this.canvas=document.createElement("canvas"),this.canvas.width=this.w,this.canvas.height=this.h,this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.prevFrame=null}detect(t){this.ctx.drawImage(t,0,0,this.w,this.h);const s=this.ctx.getImageData(0,0,this.w,this.h).data,i=s.length,a=[];if(this.prevFrame)for(let h=0;h<i;h+=4){const r=Math.abs(s[h]-this.prevFrame[h]),n=Math.abs(s[h+1]-this.prevFrame[h+1]),l=Math.abs(s[h+2]-this.prevFrame[h+2]);if(r+n+l>100){const c=h/4,g=c%this.w/this.scale,d=Math.floor(c/this.w)/this.scale;a.push({x:g,y:d})}}return this.prevFrame=s,a}}class m{constructor(t,e,s){this.x=t,this.y=e;const i=Math.random()*Math.PI*2,a=Math.random()*2+.5;this.vx=Math.cos(i)*a,this.vy=Math.sin(i)*a,this.life=1,this.decay=Math.random()*.02+.01,this.hue=s,this.size=Math.random()*3+1,this.target=null}update(){if(this.target){const t=this.target.x-this.x,e=this.target.y-this.y;Math.sqrt(t*t+e*e)>1&&(this.vx+=t*.05*.1,this.vy+=e*.05*.1,this.vx*=.8,this.vy*=.8),this.life=1}else this.vx*=.95,this.vy*=.95,this.life-=this.decay;this.x+=this.vx,this.y+=this.vy}draw(t){t.fillStyle=`hsla(${this.hue}, 100%, 60%, ${this.life})`,t.beginPath(),t.arc(this.x,this.y,this.size,0,Math.PI*2),t.fill()}}class C{constructor(t,e){this.width=t,this.height=e,this.particles=[],this.hueCycle=0,this.targets=null}resize(t,e){this.width=t,this.height=e,this.targets=null}setMode(t,e=[]){if(t==="TEXT"){this.targets=e;const s=[...e].sort(()=>Math.random()-.5);for(;this.particles.length<s.length;)this.particles.push(new m(Math.random()*this.width,Math.random()*this.height,this.hueCycle));for(let i=0;i<this.particles.length;i++)i<s.length?(this.particles[i].target=s[i],this.particles[i].hue=(this.hueCycle+i)%360):this.particles[i].target=null}else{this.targets=null;for(const s of this.particles)s.target=null}}addParticles(t){if(this.targets)return;const e=4;for(let s=0;s<t.length;s+=e)if(Math.random()>.9){const i=t[s];this.particles.push(new m(i.x,i.y,this.hueCycle))}this.hueCycle=(this.hueCycle+.5)%360}update(){for(let t=this.particles.length-1;t>=0;t--){const e=this.particles[t];e.update(),e.life<=0&&!e.target&&this.particles.splice(t,1)}}draw(t){t.globalCompositeOperation="lighter";for(const e of this.particles)e.draw(t);t.globalCompositeOperation="source-over"}}class T{constructor(t){this.video=t,this.results=null,this.hands=new window.Hands({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${e}`}),this.hands.setOptions({maxNumHands:1,modelComplexity:1,minDetectionConfidence:.5,minTrackingConfidence:.5}),this.hands.onResults(this.onResults.bind(this)),this.lastVideoTime=0}onResults(t){this.results=t}async send(t){t.currentTime!==this.lastVideoTime&&(this.lastVideoTime=t.currentTime,await this.hands.send({image:t}))}}class E{constructor(){}classify(t){if(!t)return null;const e=(l,c)=>t[l].y<t[c].y,s=e(8,5),i=e(12,9),a=e(16,13),h=e(20,17),r=t[4].y<t[5].y,n=[s,i,a,h].filter(Boolean).length;return n===0?r?"LIKE":"POWER":n===4?"FLOW":s&&i&&!a&&!h?"PEACE":s&&h&&!i&&!a?r?"LOVE":"ROCK":null}}class p{constructor(t,e){this.width=t,this.height=e,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,this.ctx=this.canvas.getContext("2d")}generateTargets(t){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.fillStyle="white",this.ctx.textAlign="center",this.ctx.textBaseline="middle";const e=Math.min(this.width,this.height)*.25;this.ctx.font=`bold ${e}px monospace`,this.ctx.fillText(t,this.width/2,this.height/2);const s=this.ctx.getImageData(0,0,this.width,this.height).data,i=[],a=8;for(let h=0;h<this.height;h+=a)for(let r=0;r<this.width;r+=a){const n=(h*this.width+r)*4;s[n+3]>128&&i.push({x:r,y:h})}return i}}async function O(){const o=document.getElementById("webcam"),t=document.getElementById("canvas"),e=t.getContext("2d");let s,i,a,h=null;function r(){t.width=window.innerWidth,t.height=window.innerHeight,s&&s.resize(t.width,t.height),a&&(a=new p(t.width,t.height))}window.addEventListener("resize",r),console.log("Initializing Webcam...");const n=new M(o);if(!await n.init()){console.error("Webcam init failed"),alert("Failed to access camera. Check console/permissions.");return}console.log("Webcam ready:",n.width,n.height),i=new b(n.width,n.height),s=new C(t.width,t.height),a=new p(t.width,t.height),console.log("Initializing Hands...");const c=new T(o),g=new E;r();async function d(){e.fillStyle="rgba(0, 0, 0, 0.1)",e.fillRect(0,0,t.width,t.height),await c.send(n.video);let f=null;if(c.results&&c.results.multiHandLandmarks&&c.results.multiHandLandmarks.length>0&&(f=g.classify(c.results.multiHandLandmarks[0])),f!==h)if(h=f,console.log("Gesture Detected:",h),h){const u=a.generateTargets(h);s.setMode("TEXT",u)}else s.setMode("FLOW");const w=i.detect(n.video),y=t.width/n.width,v=t.height/n.height,x=w.map(u=>({x:(n.width-u.x)*y,y:u.y*v}));s.addParticles(x),s.update(),s.draw(e),requestAnimationFrame(d)}d()}O();
