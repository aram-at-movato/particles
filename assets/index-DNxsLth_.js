(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function i(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?a.credentials="include":e.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(e){if(e.ep)return;e.ep=!0;const a=i(e);fetch(e.href,a)}})();class M{constructor(t){this.video=t,this.width=0,this.height=0,this.isReady=!1}async init(){if(console.log("Webcam.init() called"),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return console.error("navigator.mediaDevices.getUserMedia is not supported"),alert("Your browser does not support camera access or is not in a secure context."),!1;try{console.log("Requesting user media...");const t=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},frameRate:{ideal:60}},audio:!1});return console.log("Stream acquired",t),this.video.srcObject=t,new Promise(i=>{this.video.onloadedmetadata=()=>{console.log("Video metadata loaded"),this.width=this.video.videoWidth,this.height=this.video.videoHeight,this.video.play(),this.isReady=!0,i(!0)}})}catch(t){return console.error("Error accessing webcam details:",t),alert("Error accessing webcam: "+t.message),!1}}}class b{constructor(t,i){this.width=t,this.height=i,this.scale=.1,this.w=Math.floor(this.width*this.scale),this.h=Math.floor(this.height*this.scale),this.canvas=document.createElement("canvas"),this.canvas.width=this.w,this.canvas.height=this.h,this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.prevFrame=null}detect(t){this.ctx.drawImage(t,0,0,this.w,this.h);const s=this.ctx.getImageData(0,0,this.w,this.h).data,e=s.length,a=[];if(this.prevFrame)for(let h=0;h<e;h+=4){const r=Math.abs(s[h]-this.prevFrame[h]),n=Math.abs(s[h+1]-this.prevFrame[h+1]),l=Math.abs(s[h+2]-this.prevFrame[h+2]);if(r+n+l>100){const c=h/4,g=c%this.w/this.scale,d=Math.floor(c/this.w)/this.scale;a.push({x:g,y:d})}}return this.prevFrame=s,a}}class m{constructor(t,i,s){this.x=t,this.y=i;const e=Math.random()*Math.PI*2,a=Math.random()*2+.5;this.vx=Math.cos(e)*a,this.vy=Math.sin(e)*a,this.life=1,this.decay=Math.random()*.02+.01,this.hue=s,this.size=Math.random()*3+1,this.target=null}update(){if(this.target){const t=this.target.x-this.x,i=this.target.y-this.y;Math.sqrt(t*t+i*i)>1&&(this.vx+=t*.05*.1,this.vy+=i*.05*.1,this.vx*=.8,this.vy*=.8),this.life=1}else this.vx*=.95,this.vy*=.95,this.life-=this.decay;this.x+=this.vx,this.y+=this.vy}draw(t){t.fillStyle=`hsla(${this.hue}, 100%, 60%, ${this.life})`,t.beginPath(),t.arc(this.x,this.y,this.size,0,Math.PI*2),t.fill()}}class C{constructor(t,i){this.width=t,this.height=i,this.particles=[],this.hueCycle=0,this.targets=null}resize(t,i){this.width=t,this.height=i,this.targets=null}setMode(t,i=[]){if(t==="TEXT"){this.targets=i;const s=[...i].sort(()=>Math.random()-.5);for(;this.particles.length<s.length;)this.particles.push(new m(Math.random()*this.width,Math.random()*this.height,this.hueCycle));for(let e=0;e<this.particles.length;e++)e<s.length?(this.particles[e].target=s[e],this.particles[e].hue=(this.hueCycle+e)%360):this.particles[e].target=null}else{this.targets=null;for(const s of this.particles)s.target=null}}addParticles(t){if(this.targets)return;const i=4;for(let s=0;s<t.length;s+=i)if(Math.random()>.9){const e=t[s];this.particles.push(new m(e.x,e.y,this.hueCycle))}this.hueCycle=(this.hueCycle+.5)%360}update(){for(let t=this.particles.length-1;t>=0;t--){const i=this.particles[t];i.update(),i.life<=0&&!i.target&&this.particles.splice(t,1)}}draw(t){t.globalCompositeOperation="lighter";for(const i of this.particles)i.draw(t);t.globalCompositeOperation="source-over"}}class T{constructor(t){this.video=t,this.results=null,this.hands=new window.Hands({locateFile:i=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${i}`}),this.hands.setOptions({maxNumHands:1,modelComplexity:1,minDetectionConfidence:.5,minTrackingConfidence:.5}),this.hands.onResults(this.onResults.bind(this)),this.lastVideoTime=0}onResults(t){this.results=t}async send(t){t.currentTime!==this.lastVideoTime&&(this.lastVideoTime=t.currentTime,await this.hands.send({image:t}))}}class E{constructor(){}classify(t){if(!t)return null;const i=(l,c)=>t[l].y<t[c].y,s=i(8,5),e=i(12,9),a=i(16,13),h=i(20,17),r=[s,e,a,h].filter(Boolean).length;if(s&&e&&!a&&!h)return"PEACE";if(r===4)return"FLOW";if(r===0)return"POWER";if(s&&h&&!e&&!a)return"ROCK";const n=t[4].y<t[5].y;return r===0?n?"LIKE":"POWER":s&&h&&!e&&!a?"LOVE":null}}class p{constructor(t,i){this.width=t,this.height=i,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=i,this.ctx=this.canvas.getContext("2d")}generateTargets(t){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.fillStyle="white",this.ctx.textAlign="center",this.ctx.textBaseline="middle";const i=Math.min(this.width,this.height)*.25;this.ctx.font=`bold ${i}px monospace`,this.ctx.fillText(t,this.width/2,this.height/2);const s=this.ctx.getImageData(0,0,this.width,this.height).data,e=[],a=8;for(let h=0;h<this.height;h+=a)for(let r=0;r<this.width;r+=a){const n=(h*this.width+r)*4;s[n+3]>128&&e.push({x:r,y:h})}return e}}async function O(){const o=document.getElementById("webcam"),t=document.getElementById("canvas"),i=t.getContext("2d");let s,e,a,h=null;function r(){t.width=window.innerWidth,t.height=window.innerHeight,s&&s.resize(t.width,t.height),a&&(a=new p(t.width,t.height))}window.addEventListener("resize",r),console.log("Initializing Webcam...");const n=new M(o);if(!await n.init()){console.error("Webcam init failed"),alert("Failed to access camera. Check console/permissions.");return}console.log("Webcam ready:",n.width,n.height),e=new b(n.width,n.height),s=new C(t.width,t.height),a=new p(t.width,t.height),console.log("Initializing Hands...");const c=new T(o),g=new E;r();async function d(){i.fillStyle="rgba(0, 0, 0, 0.1)",i.fillRect(0,0,t.width,t.height),await c.send(n.video);let f=null;if(c.results&&c.results.multiHandLandmarks&&c.results.multiHandLandmarks.length>0&&(f=g.classify(c.results.multiHandLandmarks[0])),f!==h)if(h=f,console.log("Gesture Detected:",h),h){const u=a.generateTargets(h);s.setMode("TEXT",u)}else s.setMode("FLOW");const w=e.detect(n.video),y=t.width/n.width,v=t.height/n.height,x=w.map(u=>({x:(n.width-u.x)*y,y:u.y*v}));s.addParticles(x),s.update(),s.draw(i),requestAnimationFrame(d)}d()}O();
